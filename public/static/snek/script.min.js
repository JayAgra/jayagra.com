const context=document.getElementById("snake").getContext("2d"),canvas=document.getElementById("snake");var snekPositions=[],snekSpeed=111,points=0,secondsAlive=0;function fixCanvas(){window.innerWidth>window.innerHeight?(canvas.width=.7*window.innerHeight-.7*window.innerHeight%32,canvas.height=.7*window.innerHeight-.7*window.innerHeight%32,canvas.style.width=.7*window.innerHeight-.7*window.innerHeight%32,canvas.style.height=.7*window.innerHeight-.7*window.innerHeight%32):(canvas.width=.6*window.innerWidth-.6*window.innerWidth%32,canvas.height=.6*window.innerWidth-.6*window.innerWidth%32,canvas.style.width=.6*window.innerWidth-.6*window.innerWidth%32,canvas.style.height=.6*window.innerWidth-.6*window.innerWidth%32)}function randomGridPosition(e){return e?Math.floor(20*Math.random()):Math.floor(30*Math.random())}function ItemCoords(e,n){this.x=e,this.y=n}function DirectionObject(e){switch(e){case"LEFT":this.DIR=1;break;case"UP":this.DIR=2;break;case"RIGHT":this.DIR=3;break;case"DOWN":this.DIR=4;break;case"RAND":this.DIR=Math.floor(4*Math.random()+1)}}snekPositions[0]=new ItemCoords(randomGridPosition(!0),randomGridPosition(!0));var direction=new DirectionObject("RAND"),redDotThing=new ItemCoords(randomGridPosition(!0),randomGridPosition(!0));function fillRectWithObject(e){context.fillRect(e.x,e.y,1,1)}function updateBackground(){context.fillStyle="#010101",context.fillRect(0,0,32,32)}function updateSnekBlocks(){for(i=0;i<snekPositions.length;i++)context.fillStyle="#fff",fillRectWithObject(snekPositions[i])}function createRedDotThing(){let e=new Image;e.onload=function(){context.drawImage(this,redDotThing.x,redDotThing.y,1,1)},e.src="static/snek/apple.png"}function update(e){(37===e.keyCode||65===e.keyCode)&&3!=direction.DIR&&(direction=new DirectionObject("LEFT")),(38===e.keyCode||87===e.keyCode)&&4!=direction.DIR&&(direction=new DirectionObject("UP")),(39===e.keyCode||68===e.keyCode)&&1!=direction.DIR&&(direction=new DirectionObject("RIGHT")),(40===e.keyCode||83===e.keyCode)&&2!=direction.DIR&&(direction=new DirectionObject("DOWN"))}function mobileGesture(){touchendX<touchstartX&&update({keyCode:37}),touchendX>touchstartX&&update({keyCode:39}),touchendY<touchstartY&&update({keyCode:38}),touchendY>touchstartY&&update({keyCode:40}),touchendY===touchstartY&&console.log("no move")}function resetGame(){fixCanvas(),context.scale(canvas.width/32,canvas.height/32),context.imageSmoothingEnabled=!1,context.webkitImageSmoothingEnabled=!1,context.fillStyle="#111",context.fillRect(0,0,32,32),points=0,snekSpeed=111,secondsAlive=0,(snekPositions=[])[0]=new ItemCoords(randomGridPosition(),randomGridPosition()),updateBackground(),updateSnekBlocks(),createRedDotThing()}function startLv2(){resetGame(),snekPositions[0]=new ItemCoords(16,16),document.getElementById("lossNotif").style.display="none",level2()}function announceLoss(){throw document.getElementById("pointsLoss").innerHTML=points,document.getElementById("lossMessage").innerHTML="You Lost!",document.getElementById("lossMessage").style.color="#f00",document.getElementById("secondsLoss").innerHTML=secondsAlive,document.getElementById("playLevel2").disabled=!0,document.getElementById("lossNotif").style.display="block",resetGame(),Error("loss")}function announceWin(){throw document.getElementById("pointsLoss").innerHTML=points,document.getElementById("lossMessage").innerHTML="You Won!",document.getElementById("lossMessage").style.color="#0f0",document.getElementById("secondsLoss").innerHTML=secondsAlive,document.getElementById("playLevel2").disabled=!1,document.getElementById("lossNotif").style.display="block",resetGame(),Error("win")}function closeLossWindow(){document.getElementById("lossNotif").style.display="none",resetGame(),window.location.reload()}function closeStartWindow(){canvas.width=.7*window.innerHeight-.7*window.innerHeight%32,canvas.height=.7*window.innerHeight-.7*window.innerHeight%32,canvas.style.width=.7*window.innerHeight-.7*window.innerHeight%32+"px",canvas.style.height=.7*window.innerHeight-.7*window.innerHeight%32+"px",document.getElementById("intro").style.display="none",resetGame(),level1()}function getNewDelayTime(e){return 111-(Math.log(e)/Math.log(17)*3)**3*3}function findNewPos(){let e=new ItemCoords(randomGridPosition(!0),randomGridPosition(!0));if(e.x===redDotThing.x&&e.y===redDotThing.y)return findNewPos();for(i=1;i<snekPositions.length;i++)if(snekPositions[0].x===e.x&&snekPositions[0].y===e.y)return findNewPos();return e}function SnekLevel(e,n,t,o,s){this.level=e,this.playLevel=function(){function e(e,n){if(e)return announceLoss();switch(n){case 1:snekPositions[0].x=0;break;case 2:snekPositions[0].x=32;break;case 3:snekPositions[0].y=0;break;case 4:snekPositions[0].y=32}}for(snekPositions[0].x>32&&3==direction.DIR&&e(n,1),snekPositions[0].x<0&&1==direction.DIR&&e(n,2),snekPositions[0].y>32&&4==direction.DIR&&e(n,3),snekPositions[0].y<0&&2==direction.DIR&&e(n,4),i=1;i<snekPositions.length;i++)snekPositions[0].x==snekPositions[i].x&&snekPositions[0].y==snekPositions[i].y&&announceLoss();updateBackground(),updateSnekBlocks(),createRedDotThing();var d=snekPositions[0].x,r=snekPositions[0].y;if(3==direction.DIR&&(d+=1),1==direction.DIR&&(d-=1),2==direction.DIR&&(r-=1),4==direction.DIR&&(r+=1),d==redDotThing.x&&r==redDotThing.y)redDotThing=findNewPos(),points+=o,snekSpeed=getNewDelayTime(points);else if(snekPositions.pop(),snekPositions.length>=s)return announceWin(t);return snekPositions.unshift(new ItemCoords(d,r)),snekSpeed}}document.addEventListener("keydown",update),document.body.addEventListener("touchstart",function(e){touchstartX=e.changedTouches[0].screenX,touchstartY=e.changedTouches[0].screenY},!1),document.body.addEventListener("touchend",function(e){touchendX=e.changedTouches[0].screenX,touchendY=e.changedTouches[0].screenY},!1);const snekgamel1=new SnekLevel(1,!1,1,1,20);function level1(){window.setTimeout(level1,snekgamel1.playLevel())}const snekgamel2=new SnekLevel(2,!0,1,1,10);function level2(){window.setTimeout(level2,snekgamel2.playLevel())}